<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oak Tree AI | Readiness Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Tailwind gray-100 */
        }
        .quiz-card {
            background: white;
            border-radius: 1.5rem; /* 24px */
            box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25);
            transition: all 0.3s ease-in-out;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .option-label {
            transition: all 0.2s ease-in-out;
        }
        .option-label:hover {
            background-color: #eef2ff; /* Tailwind indigo-50 */
            border-color: #818cf8; /* Tailwind indigo-400 */
        }
        input:checked + .option-label {
            background-color: #e0e7ff; /* Tailwind indigo-100 */
            border-color: #6366f1; /* Tailwind indigo-500 */
            color: #4338ca; /* Tailwind indigo-800 */
            font-weight: 600;
        }
        input:checked + .option-label .custom-checkbox {
            background-color: #6366f1; /* Tailwind indigo-500 */
            border-color: #4f46e5; /* Tailwind indigo-600 */
            background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
        }
        #roadmap-content h3 {
            font-size: 1.25rem;
            font-weight: 700;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            color: #1e3a8a; /* Tailwind blue-800 */
        }
        #roadmap-content ul {
            list-style-type: disc;
            padding-left: 1.5rem;
            margin-bottom: 1rem;
        }
        #roadmap-content li {
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 bg-gray-100">

    <div id="quiz-container" class="quiz-card w-full max-w-3xl">
        <!-- Header -->
        <div class="p-8 text-center bg-gradient-to-br from-indigo-500 to-purple-600 rounded-t-3xl">
            <h1 class="text-3xl font-bold text-white">ðŸŒ³ Oak Tree AI Readiness Quiz</h1>
            <p class="mt-2 text-indigo-200">Discover your business's AI potential in just 2 minutes!</p>
        </div>

        <!-- Progress Bar -->
        <div class="w-full bg-gray-200 h-2.5">
            <div id="progress-bar" class="bg-gradient-to-r from-indigo-500 to-purple-600 h-2.5" style="width: 0%; transition: width 0.5s ease;"></div>
        </div>

        <!-- Quiz Body -->
        <div id="quiz-body" class="p-8 sm:p-12">
            <!-- Questions will be injected here by JavaScript -->
        </div>

        <!-- Footer / Navigation -->
        <div class="px-8 py-6 bg-gray-50 rounded-b-3xl border-t border-gray-200 flex items-center justify-between">
            <button id="prev-btn" class="px-6 py-2 font-semibold text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors">Previous</button>
            <button id="next-btn" class="px-8 py-2 font-semibold text-white bg-indigo-600 rounded-lg hover:bg-indigo-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed">Next</button>
        </div>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- CONFIGURATION ---
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby3mqkzFq5FMvFbqagS2HupNTKYL0w-iHmI3XwkUYpRSNjbsfinXTZyZYmz6D1CktUI/exec';
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent';
        const GEMINI_API_KEY = ''; // API key is handled by the environment, leave blank.

        // --- QUIZ DATA ---
        const quizData = [
            // Question 1
            {
                id: 'adminTime',
                question: "How many hours per week does your team spend on repetitive admin tasks?",
                options: ["Less than 5 hours", "5-10 hours", "10-20 hours", "More than 20 hours"]
            },
            // Question 2
            {
                id: 'frustrations',
                question: "What are your biggest daily frustrations?",
                options: ["Answering the same customer questions repeatedly", "Keeping track of client information", "Managing appointments and schedules", "Following up with leads and customers"]
            },
            // Question 3
            {
                id: 'inquiryHandling',
                question: "How do you currently handle new client inquiries?",
                options: ["Phone calls and manual note-taking", "Basic email responses", "Online forms (Google Forms, etc.)", "We often miss inquiries", "WhatsApp", "Facebook", "Instagram"]
            },
            // Question 4
            {
                id: 'automationPriorities',
                question: "Which area would save you the most time if automated?",
                options: ["Email responses and follow-ups", "Invoice and payment reminders", "Appointment scheduling", "Customer data organization", "Client intake form/order form", "Interactive Progress reports for client/teams"]
            },
            // Question 5
            {
                id: 'budget',
                question: "What's your monthly budget for business tools and software?",
                options: ["Under R1,000", "R1,000 - R5,000", "R5,000 - R10,000", "Over R10,000"]
            },
            // Question 6
            {
                id: 'techComfort',
                question: "How comfortable is your team with learning new technology?",
                options: ["Very comfortable - we love new tools", "Somewhat comfortable - willing to learn", "Nervous but open to simple solutions", "Prefer to stick with what we know"]
            },
            // Question 7
            {
                id: 'successGoals',
                question: "What would success look like for you in 6 months?",
                options: ["More time to focus on growing the business", "Better customer satisfaction", "Reduced operational costs", "All of the above"]
            },
            // Question 8
            {
                id: 'interactions',
                question: "How many customer interactions does your business handle weekly?",
                options: ["Under 20", "20-50", "50-100", "Over 100"]
            },
            // Question 9
            {
                id: 'currentTools',
                question: "Do you currently use any of these tools?",
                options: ["WhatsApp Business", "Email marketing platform", "CRM system", "None of the above"]
            },
            // Question 10
            {
                id: 'timeline',
                question: "When would you want to implement AI solutions?",
                options: ["Immediately", "Within 1-3 months", "Within 6 months", "Just exploring options"]
            },
        ];

        // --- DOM ELEMENTS ---
        const quizBody = document.getElementById('quiz-body');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const progressBar = document.getElementById('progress-bar');
        
        // --- STATE MANAGEMENT ---
        let currentQuestionIndex = 0;
        const userAnswers = {};

        // --- FUNCTIONS ---
        const renderQuestion = () => {
            quizBody.innerHTML = ''; // Clear previous content
            
            let content;

            if (currentQuestionIndex < quizData.length) { // Render a question
                const questionData = quizData[currentQuestionIndex];
                const questionId = currentQuestionIndex + 1;
                const savedAnswers = userAnswers[questionId] || [];

                const optionsHtml = questionData.options.map((option, index) => `
                    <div>
                        <input type="checkbox" id="q${questionId}_o${index}" value="${option}" class="absolute opacity-0" name="question-${questionId}" ${savedAnswers.includes(option) ? 'checked' : ''}>
                        <label for="q${questionId}_o${index}" class="option-label flex items-center p-4 border-2 border-gray-200 rounded-xl cursor-pointer text-gray-700">
                            <span class="custom-checkbox w-6 h-6 rounded-md border-2 border-gray-300 mr-4 transition-colors"></span>
                            ${option}
                        </label>
                    </div>
                `).join('');

                content = `
                    <div class="fade-in">
                        <p class="text-sm font-semibold text-indigo-600">Question ${questionId} of ${quizData.length}</p>
                        <h2 class="text-2xl font-bold mt-2 mb-6 text-gray-800">${questionData.question}</h2>
                        <div class="space-y-4">${optionsHtml}</div>
                    </div>
                `;
            } else if (currentQuestionIndex === quizData.length) { // Render contact form
                content = `
                    <div class="fade-in text-center">
                        <h2 class="text-2xl font-bold text-gray-800">Almost There!</h2>
                        <p class="mt-2 mb-8 text-gray-600">Enter your details to receive your personalized AI readiness insights.</p>
                        <div class="space-y-4 text-left">
                            <div>
                                <label for="name" class="block text-sm font-medium text-gray-700">Full Name</label>
                                <input type="text" id="name" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" required>
                            </div>
                            <div>
                                <label for="email" class="block text-sm font-medium text-gray-700">Email Address</label>
                                <input type="email" id="email" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" required>
                            </div>
                            <div>
                                <label for="phone" class="block text-sm font-medium text-gray-700">Phone (Optional)</label>
                                <input type="tel" id="phone" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                        </div>
                    </div>
                `;
            } else { // Render submission/final screen
                content = `
                    <div class="fade-in text-center">
                        <div id="loading-state">
                            <h2 class="text-2xl font-bold text-gray-800">âœ¨ Generating your Personal AI Roadmap...</h2>
                            <p class="mt-2 text-gray-600">Our AI is analyzing your answers to create a custom plan. This will just take a moment.</p>
                        </div>
                        <div id="success-state" style="display: none;" class="text-left">
                             <h2 class="text-3xl font-bold text-green-600 text-center">Here is Your AI Roadmap!</h2>
                            <p class="mt-2 mb-6 text-gray-600 text-center">Based on your answers, here are some key areas where AI can make an immediate impact on your business.</p>
                            <div id="roadmap-content" class="p-6 bg-gray-50 rounded-lg border"></div>
                            <p class="mt-6 text-center text-gray-700">A copy of this, along with our AI Roadmap PDF, has been sent to your inbox.</p>
                        </div>
                    </div>
                `;
            }
            quizBody.innerHTML = content;
            addInputListeners();
            updateUI();
        };

        const updateUI = () => {
            const progress = (currentQuestionIndex / (quizData.length)) * 100;
            progressBar.style.width = `${progress}%`;
            progressBar.style.display = currentQuestionIndex > quizData.length ? 'none' : 'block';
            prevBtn.style.visibility = currentQuestionIndex > 0 ? 'visible' : 'hidden';
            
            if(currentQuestionIndex === quizData.length) {
                nextBtn.innerHTML = 'âœ¨ Generate My Personal AI Roadmap';
            } else {
                nextBtn.textContent = 'Next';
            }
            
            if(currentQuestionIndex > quizData.length) {
                 prevBtn.style.display = 'none';
                 nextBtn.style.display = 'none';
            } else {
                 prevBtn.style.display = 'inline-block';
                 nextBtn.style.display = 'inline-block';
            }

            validateStep();
        };
        
        const validateStep = () => {
             if (currentQuestionIndex < quizData.length) {
                const checked = quizBody.querySelector('input[type="checkbox"]:checked');
                nextBtn.disabled = !checked;
            } else if (currentQuestionIndex === quizData.length) {
                const name = document.getElementById('name')?.value || '';
                const email = document.getElementById('email')?.value || '';
                const isEmailValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
                nextBtn.disabled = !(name.trim() && isEmailValid);
            }
        };

        const addInputListeners = () => {
            const inputs = quizBody.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('change', validateStep);
                input.addEventListener('input', validateStep);
            });
        };

        const generateRoadmapPrompt = () => {
            let summary = "A potential client, a small business owner in South Africa, has completed a readiness quiz. Based on their answers, generate a brief, personalized AI roadmap. \n\n";
            quizData.forEach((q, index) => {
                const questionId = index + 1;
                const answer = userAnswers[questionId] ? userAnswers[questionId].join(', ') : 'Not answered';
                summary += `- ${q.question}: ${answer}\n`;
            });

            return summary;
        };
        
        const simpleMarkdownToHtml = (text) => {
            // Converts ### headers to h3 tags
            text = text.replace(/### (.*)/g, '<h3 class="text-xl font-bold mb-2 mt-4 text-gray-800">$1</h3>');
            // Converts * list items to li tags
            text = text.replace(/\* (.*)/g, '<li class="ml-5 list-disc">$1</li>');
            // Wraps list items in ul tags
            text = text.replace(/(<li>.*<\/li>)/gs, '<ul>$1</ul>');
             // Converts bold text **text** to <strong>
            text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            return text;
        };

        const callGeminiAPI = async (prompt) => {
            const systemInstruction = "You are an expert AI consultant for small and medium businesses in South Africa, operating as 'Oak Tree AI'. Your tone is encouraging, professional, and practical. You provide actionable advice, avoiding overly technical jargon. Your goal is to show the business owner the potential of AI and encourage them to book a consultation. Structure your response in Markdown with sections for 'Key Opportunities', 'Recommended First Steps', 'A Note on Your Budget & Timeline', and 'Your Next Step with Oak Tree AI'. Use ### for headings.";
            
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: systemInstruction }] },
            };

            try {
                const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) {
                    throw new Error(`API call failed with status: ${response.status}`);
                }
                const result = await response.json();
                return result.candidates?.[0]?.content?.parts?.[0]?.text || "We couldn't generate a roadmap at this time, but our team will review your answers and be in touch shortly.";
            } catch (error) {
                console.error("Gemini API Error:", error);
                return "We encountered an issue while generating your personalized roadmap. Our team has received your submission and will create a manual report for you. Please expect it in your inbox within 24 hours.";
            }
        };


        const handleSubmit = async () => {
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            
            currentQuestionIndex++;
            renderQuestion(); // Renders the loading state

            // --- âœ¨ GEMINI API CALL ---
            const prompt = generateRoadmapPrompt();
            const roadmapText = await callGeminiAPI(prompt);
            const roadmapHtml = simpleMarkdownToHtml(roadmapText);
            
            // Display the roadmap
            const roadmapContent = document.getElementById('roadmap-content');
            if (roadmapContent) {
                roadmapContent.innerHTML = roadmapHtml;
            }
            document.getElementById('loading-state').style.display = 'none';
            document.getElementById('success-state').style.display = 'block';


            // --- SEND DATA TO GOOGLE SCRIPT (in background) ---
            let score = 0;
            Object.values(userAnswers).forEach(answerArray => score += answerArray.length);

            const payload = {
                name, email, phone, score, answers: userAnswers,
                timestamp: new Date().toISOString(),
                details: quizData.reduce((acc, q, i) => {
                    const questionId = i + 1;
                    acc[q.id] = userAnswers[questionId] ? userAnswers[questionId].join(', ') : 'N/A';
                    return acc;
                }, {})
            };
            
            try {
                await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    cache: 'no-cache',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
            } catch(error) {
                console.error('Google Script Submission Error:', error);
                // The user has already seen their roadmap, so we don't need to show an error here.
                // The lead data just might not save, which is a recoverable issue.
            }
        };

        // --- EVENT LISTENERS ---
        nextBtn.addEventListener('click', () => {
            if (currentQuestionIndex < quizData.length) {
                const questionId = currentQuestionIndex + 1;
                const checkedBoxes = quizBody.querySelectorAll(`input[name="question-${questionId}"]:checked`);
                userAnswers[questionId] = Array.from(checkedBoxes).map(cb => cb.value);
                
                currentQuestionIndex++;
                renderQuestion();
            } else {
                handleSubmit();
            }
        });

        prevBtn.addEventListener('click', () => {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion();
            }
        });

        // --- INITIAL RENDER ---
        renderQuestion();
    });
</script>

</body>
</html>
